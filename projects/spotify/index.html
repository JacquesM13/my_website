<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Portfolio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        html, body {
          height: 100%;
        }
        body {
          display: flex;
          flex-direction: column;
        }
        main {
          flex: 1; /* pushes footer down */
        }
    </style>
</head>


<body>


<!-- Navbar -->
<div class="container-fluid px-5">
    <header class="p-3 mb-3 border-bottom">
        <div class="container d-flex flex-wrap align-items-center">
            <h3 class="me-auto"><a href="/" class="nav-link link-body-emphasis ">Jacques Massey</a></h3>
            <a href="/blog/" class="nav-link px-3 link-body-emphasis fs-5">Blog(ish)</a>
            <a href="/projects/" class="nav-link px-3 link-body-emphasis fs-5">Projects</a>
            <a href="/education/" class="nav-link px-3 link-body-emphasis fs-5">Education</a>
        </div>
    </header>
</div>


<!-- Content -->
<main class="container-fluid px-5">
    <div class="px-4 pt-2 my-4 text-center">
        <h1 class="display-4 fw-bold text-body-emphasis">Spotify</h1>
    </div>

    <div class="row g-5">
        <div class="col-md-8">
            <article class="blog-post"><h2 class="display-5 link-body-emphasis mb-1">Easily Make Your New Favourite
                Playlist</h2>
                <p>Scraping the Billboard website and making Spotify playlists.</p>
                <hr>
                <h2>Functionality</h2>
                <p>This was a really fun project using APIs and webscraping to create Spotify playlists. The program
                    asks the user for a date, and uses this date to retrieve Billboard's <i>Hot 100</i> at that
                    time, before redirecting the user to Spotify where a new playlist is automatically made with the 100
                    tracks.</p>
                <h2>Beautiful Soup</h2>
                <p>Beautiful Soup is a Python library that simplifies web scraping by helping you extract data from HTML
                    pages. It lets you navigate, search, and modify elements in a webpage’s structure with ease. When
                    combined with libraries like requests, it allows you to download and parse web content efficiently.
                    Beautiful Soup supports tag, attribute, and text-based searches, making it ideal for gathering
                    specific information from websites. It’s also resilient to messy or inconsistent HTML, which is
                    common when scraping real-world pages.</p>
                <hr>
                <h2>Code</h2>
                <br>
                <h2>Step-by-Step</h2>
                <ol>
                    <li>Ask the User for a date to travel to</li>
                    <li>Use Python's Request module to fetch the relevant Billboard Hot 100 page</li>
                    <li>Use Beautiful Soup to parse the html, extracting song names and artists from the page</li>
                    <li>Initialise Spotify instance</li>
                    <ol>
                        <li>Define scope for authorisation, i.e. allowing playlist creation and modification</li>
                        <li>Redirect user to auth page for Spotify login</li>
                        <li>Spotify will return user's id and an access token to create a playlist on the user's
                            account
                        </li>
                        <li>The earlier list of song names and artists can then be searched for on Spotify and added to
                            a playlist
                        </li>
                    </ol>
                </ol>
                <br>
                <h3>Code Files</h3>
                <!-- Code Tabs -->
                <ul class="nav nav-tabs" id="codeTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="main-tab" data-bs-toggle="tab" data-bs-target="#main"
                                type="button" role="tab">main.py
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="spotify-tab" data-bs-toggle="tab" data-bs-target="#spotify"
                                type="button" role="tab">spotify.py
                        </button>
                    </li>
                </ul>

                <div class="tab-content p-3 bg-body-tertiary rounded-bottom" id="codeTabsContent">

                    <div class="tab-pane fade show active" id="main" role="tabpanel">
                        <pre class="rounded-3 overflow-auto">
                            <code class="language-python">
import requests
from bs4 import BeautifulSoup
from spotify import Spotify

BILLBOARD_ENDPOINT = "https://www.billboard.com/charts/hot-100/"

header = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0"}

date = input("What year do you want to travel to? (YYYY-MM-DD format): ")
# date = '2025-05-14'
response = requests.get(url= f"{BILLBOARD_ENDPOINT}{date}/", headers= header)
response.raise_for_status()

soup = BeautifulSoup(response.text, "html.parser")

songs = soup.select(selector= 'li.o-chart-results-list__item > h3#title-of-a-story')
artists = soup.select(selector= 'li.o-chart-results-list__item > h3#title-of-a-story + span.c-label')

song_list = [song.text.strip() for song in songs]
artist_list = [artist.text.strip().replace('Featuring', '') for artist in artists]

song_dict = dict(zip(artist_list, song_list))
# print(song_dict)

spotify = Spotify()

redirect = input("Paste URL here: ")
code = redirect.split('code=')[1]

spotify.get_bearer(code)
spotify.get_user_id()
playlist_name = input("What would you like to call your playlist? ")
spotify.create_playlist(playlist_name)
# artist, song = input("What song would you like to add to the playlist? (artist, song)? ").split(', ')
# print(artist)
# print(song)

for artist, song in song_dict.items():
    spotify.get_song(artist, song)
                            </code>
                        </pre>
                    </div>

                    <div class="tab-pane fade" id="spotify" role="tabpanel">
                        <pre class="rounded-3 overflow-auto">
                            <code class="language-python">
import urllib.parse
import requests
import os

class Spotify:
    def __init__(self):
        self.CLIENT_ID = os.environ.get('CLIENT_ID')
        self.CLIENT_SECRET = os.environ.get('CLIENT_SECRET')
        self.REDIRECT_URI = 'https://www.example.com/'
        self.code= ''
        self.access_token = ''
        self.refresh_token = ''
        self.user_id = ''
        self.playlist_id = ''
        self.authorize()


    def authorize(self):
        scopes = 'playlist-modify-public playlist-modify-private user-read-private user-read-email'  # Add more scopes as needed
        auth_url = 'https://accounts.spotify.com/authorize'
        params = {
            "client_id": self.CLIENT_ID,
            "response_type": "code",
            "redirect_uri": self.REDIRECT_URI,
            "scope": scopes
        }

        url = f"{auth_url}?{urllib.parse.urlencode(params)}"
        print("Visit this URL to authorize the app:", url)


    def get_bearer(self, code):

        with open("code.txt", 'w') as code_file:
            code_file.write(code)

        token_url = 'https://accounts.spotify.com/api/token'
        data = {
            'grant_type': 'authorization_code',
            'code': code,
            'redirect_uri': self.REDIRECT_URI,
            'client_id': self.CLIENT_ID,
            'client_secret': self.CLIENT_SECRET
        }

        response = requests.post(token_url, data=data)
        tokens = response.json()

        self.access_token = tokens.get("access_token")
        self.refresh_token = tokens.get("refresh_token")  # Save this for future use
        expires_in = tokens.get("expires_in")  # in seconds

        print("Access Token:", self.access_token)
        print("Refresh Token:", self.refresh_token)


    def refresh_access_token(self):
        token_url = 'https://accounts.spotify.com/api/token'
        data = {
            'grant_type': 'refresh_token',
            'refresh_token': self.refresh_token,
            'client_id': self.CLIENT_ID,
            'client_secret': self.CLIENT_SECRET
        }

        response = requests.post(token_url, data=data)
        tokens = response.json()

        if "access_token" in tokens:
            self.access_token = tokens["access_token"]
        else:
            raise Exception(f"Failed to refresh token: {tokens}")


    def get_user_id(self):
        header = {
            'Authorization': f"Bearer {self.access_token}",
        }
        response = requests.get(url= "https://api.spotify.com/v1/me", headers= header)
        print(response.json())

        self.user_id = response.json()['id']


    def create_playlist(self, name):
        header = {
            'Authorization': f"Bearer {self.access_token}",
            'Content-Type': 'application/json',
        }

        body = {
            "name": name
        }

        response = requests.post(url= f"https://api.spotify.com/v1/users/{self.user_id}/playlists", headers= header, json= body)
        print(response.json())
        self.playlist_id = response.json()['id']

    def get_song(self, artist, song):
        endpoint = 'https://api.spotify.com/v1/search'

        header = {
            'Authorization': f"Bearer {self.access_token}",
        }

        query = f'artist:{artist} track:{song} '

        params = {
            'q': query,
            'type': 'track',
            'limit': 1,
            # 'market': 'GB'
        }

        response = requests.get(url= f"{endpoint}", params= params, headers= header)
        print(response.json())
        try:
            uri = response.json()['tracks']['items'][0]['uri']
        except IndexError:
            print("Index Error")
        else:
            self.add_to_playlist(uri)


    def add_to_playlist(self, uri):
        header = {
            'Authorization': f"Bearer {self.access_token}",
            'Content-Type': 'application/json',
        }

        body = {
            "uris": [uri]
        }

        response = requests.post(url=f"https://api.spotify.com/v1/playlists/{self.playlist_id}/tracks", json=body, headers= header)
        print(response.text)
                            </code>
                        </pre>
                    </div>
                </div>
            </article>
        </div>
        <!--        <div class="col-md-4">-->
        <!--            <div class="position-sticky" style="top: 2rem;">-->
        <!--                <div class="rounded">-->
        <!--                    <img src="/images/Spotify.png"-->
        <!--                         class="img-fluid  rounded-4 mb-5"-->
        <!--                         alt="Snake Game image" width="400" height="400">-->
        <!--                </div>-->
        <!--            </div>-->
        <!--        </div>-->

        <div class="col-md-4">
            <div class="position-sticky" style="top: 2rem;">
                <div class="rounded text-center">

                    <img id="manualCycler"
                         src="/images/Billboard.jpg"
                         class="img-fluid rounded-4 mb-3"
                         alt="Project image"
                         width="400" height="400"
                         style="object-fit: cover; width: 400px; height: 400px;">

                    <div>
                        <button class="btn btn-dark btn-sm rounded-circle me-2" onclick="prevImage()">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="btn btn-dark btn-sm rounded-circle" onclick="nextImage()">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>


<!-- Footer -->
<div class="container-fluid px-5">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-2 my-2 mt-auto">
        <div class="col-md-4 d-flex align-items-center">
            <span class="mb-3 mb-md-0 text-body-secondary">© Jacques Massey 2025</span>
        </div>
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3">
                <a class="text-body-secondary" href="https://www.goodreads.com/user/show/99919158-jacques"
                   aria-label="Goodreads">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                         class="bi bi-instagram" viewBox="0 0 16 16">
                        <path d="M3.4250999999999996 12.512599999999999h0.08575833333333333c0.3889833333333333 0 0.7810291666666667 0 1.1700125 0.0030624999999999997 0.04900833333333333 0 0.09494999999999999 -0.012249999999999999 0.1102625 0.06432083333333333 0.2174625 1.0689374999999999 0.9188583333333333 1.6723208333333333 1.9265374999999998 1.9571666666666667 0.8239125 0.23277499999999998 1.6570083333333332 0.23890416666666664 2.490104166666667 0.05512916666666666 1.0352458333333332 -0.22665000000000002 1.7151999999999998 -0.8667875 2.082745833333333 -1.8499624999999997 0.24502916666666666 -0.6585166666666666 0.327725 -1.3415333333333335 0.3369125 -2.0368041666666663 0.0030624999999999997 -0.1776458333333333 0.009191666666666666 -1.4395416666666665 -0.006124999999999999 -1.6171875l-0.027566666666666663 -0.0091875c-0.024499999999999997 0.045941666666666665 -0.052066666666666664 0.08882083333333332 -0.07657083333333332 0.1347625 -0.6768916666666667 1.3200958333333332 -1.8775291666666665 2.0643666666666665 -3.2282499999999996 2.1164375 -3.154745833333333 0.1225125 -5.188483333333333 -1.7458291666666668 -5.268116666666666 -5.396758333333333 -0.015316666666666666 -0.7258958333333334 0.05512916666666666 -1.4364791666666665 0.25421666666666665 -2.1348125C3.9059708333333334 1.6210749999999998 5.5599125 0.1784708333333333 7.988758333333333 0.16009166666666666c1.8775333333333333 -0.012249999999999999 3.1087999999999996 1.1853291666666665 3.5590416666666664 2.1531916666666664 0.0153125 0.03369166666666666 0.03981666666666667 0.07044583333333333 0.07350833333333333 0.05819166666666667V0.48475416666666665h1.3568458333333333c0 8.585191666666667 0.0030624999999999997 10.174816666666667 0.0030624999999999997 10.174816666666667 -0.0030624999999999997 2.404345833333333 -0.8177833333333333 4.401329166666667 -3.1547416666666668 4.967958333333333 -2.1286875 0.5176208333333333 -4.8699458333333325 0.14701666666666666 -6.0032041666666665 -1.751958333333333 -0.24502916666666666 -0.4134833333333333 -0.3614166666666666 -0.8667875 -0.39817083333333336 -1.3629708333333332ZM7.906062499999999 1.2780375c-1.6079999999999999 -0.015316666666666666 -3.3232 1.2465833333333332 -3.5222874999999996 4.098104166666666 -0.12557916666666666 1.8070833333333332 0.4533041666666667 3.7428125 2.1899416666666665 4.551408333333333 0.8453499999999999 0.3951083333333333 2.2757041666666664 0.459425 3.3170791666666664 -0.2664708333333333 1.4579166666666667 -1.0168666666666666 1.920408333333333 -2.970970833333333 1.6784458333333332 -4.716799999999999 -0.2971 -2.1776916666666666 -1.464045833333333 -3.6754333333333333 -3.6631791666666667 -3.6662416666666666Z"
                              fill="#000000" stroke-width="0.0417"></path>
                    </svg>
                </a>
            </li>
            <li class="ms-3">
                <a class="text-body-secondary" href="https://github.com/JacquesM13"
                   aria-label="GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                         class="bi bi-instagram" viewBox="0 0 16 16">
                        <path d="M7.999933333333333 0.35346666666666665c-1.8616000000000001 0.00006666666666666667 -3.662466666666666 0.6626 -5.080266666666667 1.8689333333333331C1.5017999999999998 3.4287333333333327 0.5594666666666666 5.100266666666666 0.26126666666666665 6.937866666666666c-0.29819999999999997 1.8375333333333332 0.0672 3.7212666666666667 1.0308 5.3141333333333325 0.9635333333333334 1.5927333333333333 2.462466666666667 2.790733333333333 4.228533333333333 3.3795333333333333 0.39199999999999996 0.0686 0.5389999999999999 -0.1666 0.5389999999999999 -0.37239999999999995 0 -0.18619999999999998 -0.0098 -0.8036 -0.0098 -1.4602 -1.9697999999999998 0.36260000000000003 -2.4794 -0.4801333333333333 -2.6361999999999997 -0.9211333333333332 -0.174 -0.4288666666666666 -0.4498 -0.8089333333333333 -0.8036 -1.1074 -0.2744 -0.147 -0.6664 -0.5095999999999999 -0.0098 -0.5194 0.2507333333333333 0.027200000000000002 0.4911333333333333 0.11446666666666666 0.7010000000000001 0.2543333333333333 0.2098 0.13986666666666664 0.3828666666666667 0.3283333333333333 0.5044 0.5492666666666666 0.10719999999999999 0.1926 0.25139999999999996 0.36219999999999997 0.4242666666666666 0.499 0.17286666666666664 0.13679999999999998 0.37106666666666666 0.2382 0.5831999999999999 0.29819999999999997 0.2121333333333333 0.060066666666666664 0.434 0.07773333333333332 0.6529333333333334 0.05193333333333333s0.43066666666666664 -0.09453333333333333 0.6229333333333333 -0.2023333333333333c0.03393333333333333 -0.39859999999999995 0.2116 -0.7712666666666667 0.4998666666666667 -1.0486 -1.7444 -0.19599999999999998 -3.5671999999999997 -0.8722 -3.5671999999999997 -3.8709999999999996 -0.011 -0.7791333333333333 0.27646666666666664 -1.533 0.8036 -2.106933333333333 -0.23966666666666664 -0.6772 -0.21166666666666667 -1.4203999999999999 0.0784 -2.0776 0 0 0.6565333333333333 -0.20579999999999998 2.1559999999999997 0.8036 1.2828 -0.3528 2.6370666666666667 -0.3528 3.9199333333333333 0 1.4993999999999998 -1.0191999999999999 2.1559999999999997 -0.8036 2.1559999999999997 -0.8036 0.29006666666666664 0.6572 0.3181333333333333 1.4003999999999999 0.0784 2.0776 0.5286 0.5729333333333333 0.8164666666666666 1.3275333333333332 0.8036 2.106933333333333 0 3.0086 -1.8325999999999998 3.675 -3.577 3.8709999999999996 0.18706666666666666 0.1896 0.3311333333333333 0.41733333333333333 0.42246666666666666 0.6675333333333333 0.09133333333333334 0.2503333333333333 0.1277333333333333 0.5173333333333333 0.10673333333333332 0.7828666666666666 0 1.0486666666666666 -0.0098 1.8913333333333333 -0.0098 2.1559333333333335 0 0.20579999999999998 0.147 0.4508 0.5389999999999999 0.37239999999999995 1.7629333333333332 -0.5935333333333332 3.2575333333333334 -1.7943333333333333 4.217 -3.3879333333333332 0.9595333333333333 -1.5936666666666666 1.3214 -3.476466666666666 1.0211333333333332 -5.312266666666666 -0.3002666666666667 -1.8357333333333332 -1.2431333333333332 -3.5050666666666666 -2.6604 -4.709933333333333C11.659466666666667 1.0164666666666666 9.860133333333334 0.3544666666666666 7.999933333333333 0.35346666666666665Z"
                              fill="#000000" stroke-width="0.6667"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

<script>
    // Array of image URLs
    const images = [
      '/images/Billboard.jpg',
      '/images/Playlist.jpg'
    ];

    // Track which image is currently showing
    let index = 0;

    // Grab the <img> element
    const img = document.getElementById('manualCycler');

    // Helper to show the image at the current index
    function showImage(i) {
      img.src = images[i];
    }

    // Next / Previous controls
    function nextImage() {
      index = (index + 1) % images.length;
      showImage(index);
    }

    function prevImage() {
      index = (index - 1 + images.length) % images.length;
      showImage(index);
    }
</script>
</body>
</html>
